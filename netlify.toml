###########################################
# BUILD SETTINGS
###########################################
[build]
  publish   = "."
  functions = "netlify/functions"

###########################################
# SECURITY HEADERS (static pages)
###########################################
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

###########################################
# CORS FOR NETLIFY FUNCTIONS (proxy to Apps Script)
###########################################
[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    Access-Control-Allow-Origin  = "*"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"
    Access-Control-Allow-Headers = "Content-Type, Authorization"
    Access-Control-Max-Age       = "600"
    Vary                         = "Origin"

###########################################
# LIGHT CACHING (CSS / helpers)
###########################################
[[headers]]
  for = "/app.css"
  [headers.values]
    Cache-Control = "public, max-age=3600"

[[headers]]
  for = "/helpers.js"
  [headers.values]
    Cache-Control = "public, max-age=3600"

###########################################
# SERVICE WORKER CONTROL
###########################################
[[headers]]
  for = "/service-worker.js"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"
    Service-Worker-Allowed = "/"

###########################################
# OPTIONAL: IMAGE & PDF CACHING
###########################################
[[headers]]
  for = "/assets/img/*"
  [headers.values]
    Cache-Control = "public, max-age=604800, immutable"

[[headers]]
  for = "/assets/pdfs/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

###########################################
# JSON DATA: correct MIME + short cache
###########################################
[[headers]]
  for = "/data/*.json"
  [headers.values]
    Content-Type = "application/json; charset=utf-8"
    Cache-Control = "public, max-age=60"

###########################################
# REDIRECTS / ROUTING
###########################################
# ✅ Serve JSON as-is (never route to index.html)
[[redirects]]
  from = "/data/*"
  to   = "/data/:splat"
  status = 200

# ✅ Serve functions normally
[[redirects]]
  from = "/.netlify/functions/*"
  to   = "/.netlify/functions/:splat"
  status = 200

# ✅ SPA fallback for everything else
[[redirects]]
  from = "/*"
  to   = "/index.html"
  status = 200
  force  = false
