<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GAR Summary ‚Ä¢ CFD Marine Team</title>
  <link rel="stylesheet" href="../app.css" />
  <style>
    html, body {
      background:#111; color:#eee;
      font-family: system-ui, sans-serif;
      text-align:center;
    }

    .container { max-width:1000px; margin:0 auto; padding:16px; }
    h1 { color:#ffcc00; font-size:1.6rem; margin-bottom:10px; }

    .patch-header {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      margin-bottom:12px;
    }
    .patch-header img {
      width:72px;
      height:72px;
      border-radius:12px;
      object-fit:contain;
    }
    .patch-header .title-text {
      font-size:1.2rem;
      color:#ffcc00;
      font-weight:700;
    }

    .section {
      background:#1c1c1c;
      border:1px solid #333;
      border-radius:14px;
      padding:18px;
      margin-bottom:18px;
      box-shadow:0 0 10px rgba(0,0,0,0.3);
      text-align:left;
    }
    .section h2 { color:#ffcc00; font-size:1.2rem; margin-bottom:8px; }

    .meta { font-size:0.95rem; color:#ccc; margin-bottom:8px; }
    .crew-list { margin-top:10px; font-size:0.95rem; color:#ddd; }
    .crew-list span {
      background:#222;
      border-radius:8px;
      padding:4px 10px;
      margin:3px;
      display:inline-block;
    }

    .decision {
      border-radius:14px;
      padding:16px;
      font-weight:700;
      font-size:1.1rem;
      text-align:center;
      border:2px solid #333;
      background:#161616;
      box-shadow:0 0 8px rgba(0,0,0,0.4);
    }
    .decision.green { background:#163016; border-color:#267d26; color:#adffad; }
    .decision.yellow { background:#3b3b12; border-color:#b4a630; color:#fffab0; }
    .decision.red { background:#401515; border-color:#a83535; color:#ffb0b0; }

    .nav-rail { display:flex; justify-content:center; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
    .btn {
      background:#1e1e1e;
      border:2px solid #555;
      color:#eee;
      padding:10px 14px;
      border-radius:10px;
      text-decoration:none;
      font-size:1rem;
    }
    .btn:hover { border-color:#ffcc00; background:#2a2a2a; }

    .print-btn {
      background:#ffcc00;
      color:#000;
      border:0;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 0 8px rgba(255,204,0,0.3);
    }
    .print-btn:hover { background:#ffe066; }

    ul { list-style:none; padding:0; }
    li { margin:4px 0; }
    strong { color:#ffcc00; }

    /* Print-specific styles */
    @media print {
      body { background:#fff; color:#000; }
      .nav-rail, .print-btn { display:none !important; }
      .patch-header img {
        width:90px; height:90px;
      }
      .patch-header .title-text {
        color:#000; font-size:1.4rem;
      }
      .section {
        background:#fff;
        border:1px solid #000;
        color:#000;
        box-shadow:none;
        page-break-inside:avoid;
      }
      .decision.green, .decision.yellow, .decision.red {
        color:#000;
        border-color:#000;
        background:#fff;
      }
      .crew-list span {
        background:#eee;
        color:#000;
      }
      h1 { color:#000; }
      strong { color:#000; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="patch-header">
      <img src="../assets/icons/icon-192.png" alt="CFD Marine Team Patch">
      <div class="title-text">CFD Marine Team GAR 2.0 Summary</div>
    </div>

    <h1>GAR Summary</h1>

    <div class="nav-rail">
      <a class="btn" href="./gar-home.html">‚Üê Back to GAR Home</a>
      <a class="btn" href="../index.html">Home</a>
      <button class="print-btn" onclick="window.print()">üñ®Ô∏è Export / Print GAR Summary</button>
    </div>

    <div id="gar-summary"></div>
  </div>

  <script>
    async function loadGAR() {
      const params = new URLSearchParams(location.search);
      const boat = params.get('boat');
      const date = params.get('date');
      const summary = document.getElementById('gar-summary');

      if (!boat || !date) {
        summary.innerHTML = '<p>Missing parameters.</p>';
        return;
      }

      try {
        const res = await fetch(`/.netlify/functions/gar-get?boat=${boat}&date=${date}`);
        if (!res.ok) throw new Error('Record not found.');
        const records = await res.json();
        const gar = records[0];
        if (!gar) {
          summary.innerHTML = '<p>No GAR found for that date.</p>';
          return;
        }

        const colorClass = gar.color || '';
        summary.innerHTML = `
          <div class="section">
            <h2>Mission Details</h2>
            <div class="meta">
              <strong>Boat:</strong> ${gar.boat}<br>
              <strong>Date:</strong> ${gar.date} ‚Ä¢ <strong>Shift:</strong> ${gar.shift}<br>
              <strong>Time:</strong> ${gar.time}<br>
              <strong>Location:</strong> ${gar.location || ''}<br>
              <strong>Submitted:</strong> ${new Date(gar.submittedAt).toLocaleString()}
            </div>
            <div class="crew-list"><strong>Crew:</strong><br>
              ${gar.crew.map(c => `<span>${c}</span>`).join(' ')}
            </div>
          </div>

          <div class="section">
            <h2>Risk Assessment</h2>
            <ul>
              <li><strong>Planning:</strong> ${gar.riskElements?.planning || '‚Äî'}</li>
              <li><strong>Event:</strong> ${gar.riskElements?.event || '‚Äî'}</li>
              <li><strong>Asset ‚Äì Crew:</strong> ${gar.riskElements?.assetCrew || '‚Äî'}</li>
              <li><strong>Asset ‚Äì Boat:</strong> ${gar.riskElements?.assetBoat || '‚Äî'}</li>
              <li><strong>Communications:</strong> ${gar.riskElements?.communications || '‚Äî'}</li>
              <li><strong>Environment:</strong> ${gar.riskElements?.environment || '‚Äî'}</li>
            </ul>
          </div>

          <div class="section">
            <h2>Command Decision</h2>
            <div class="decision ${colorClass}">${gar.commandDecision || '‚Äî'}</div>
          </div>
        `;
      } catch (err) {
        summary.innerHTML = `<p style="color:#f77;">${err.message}</p>`;
      }
    }

    loadGAR();
  </script>
</body>
</html>
