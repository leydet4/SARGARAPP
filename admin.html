<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - POV SAR 2026</title>

<link rel="icon" href="SAR.png">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: system-ui, sans-serif; }

.card {
  background:#1e293b;
  border-radius:16px;
  padding:24px;
  box-shadow:0 0 25px rgba(0,0,0,.35);
}

.btn {
  padding:10px 16px;
  border-radius:10px;
  font-weight:700;
  transition:.2s;
}

.btn-primary { background:#2563eb; }
.btn-primary:hover { background:#1d4ed8; }

.btn-danger { background:#dc2626; }
.btn-danger:hover { background:#b91c1c; }

.btn-disabled {
  background:#555 !important;
  cursor:not-allowed;
}

.select {
  width:100%;
  padding:12px;
  border-radius:10px;
  background:#334155;
  font-weight:600;
}

iframe {
  width:100%;
  height:600px;
  border:none;
  border-radius:12px;
}

.resource-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#334155;
  padding:12px;
  border-radius:10px;
  transition:.3s ease;
}

.fade-out {
  opacity:0;
  transform:scale(.95);
}

#adminContent { display:none; }
</style>
</head>

<body class="bg-slate-900 text-white">

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center">
  <div class="card w-full max-w-md text-center">
    <img src="SAR.png" class="mx-auto h-14 mb-4">
    <h2 class="text-xl font-bold mb-4">Admin Access Required</h2>
    <input type="password"
           id="adminPassword"
           placeholder="Enter Admin Password"
           class="w-full p-3 rounded bg-slate-700 mb-4">
    <button onclick="checkPassword()"
            class="btn btn-primary w-full">
      Enter Admin Panel
    </button>
    <div id="loginError" class="mt-3 text-red-400 font-bold hidden">
      Incorrect password
    </div>
  </div>
</div>

<!-- ADMIN CONTENT -->
<div id="adminContent">

<header class="bg-slate-800 py-6 text-center shadow-lg">
  <img src="SAR.png" class="mx-auto h-16 mb-3">
  <h1 class="text-2xl font-black">Admin Dashboard</h1>
  <a href="index.html"
     class="inline-block mt-4 px-5 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold text-sm">
     ‚Üê Back to Dashboard
  </a>
</header>

<section class="p-6 max-w-5xl mx-auto space-y-8">

<!-- GAR VIEWER -->
<div class="card">
<h2 class="text-xl font-bold mb-4">GAR Sheet Viewer</h2>

<select id="sheetSelector" class="select mb-4">
  <option value="">Select GAR Sheet...</option>
  <option value="TF1">Task Force 1</option>
  <option value="TF2">Task Force 2</option>
  <option value="TF3">Task Force 3</option>
  <option value="TF4">Task Force 4</option>
  <option value="ADMIN">Admin / Other</option>
</select>

<div id="sheetContainer" class="hidden">
  <iframe id="sheetFrame"></iframe>
</div>
</div>

<!-- UPLOAD -->
<div class="card">
<h2 class="text-xl font-bold mb-4">Upload New Resource</h2>

<form id="uploadForm" class="space-y-4">
  <input type="text"
         id="title"
         placeholder="Display Name (Optional)"
         class="w-full p-3 rounded bg-slate-700">

  <input type="file"
         id="fileInput"
         required
         class="w-full p-3 rounded bg-slate-700">

  <button type="submit"
          class="btn btn-primary w-full">
    Upload File
  </button>
</form>

<div id="status" class="mt-4 font-bold"></div>
</div>

<!-- FILE MANAGEMENT -->
<div class="card">
<h2 class="text-xl font-bold mb-4">Manage Uploaded Files</h2>
<div id="adminResourceList" class="space-y-3">
Loading...
</div>
</div>

</section>
</div>

<script>

// üîê PASSWORD
const ADMIN_PASSWORD = "SAR2026";

function checkPassword() {
  const input = document.getElementById("adminPassword").value;
  if (input === ADMIN_PASSWORD) {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("adminContent").style.display = "block";
    loadAdminResources();
  } else {
    document.getElementById("loginError").classList.remove("hidden");
  }
}

// üìä GAR LINKS
const sheetLinks = {
  TF1: "https://docs.google.com/spreadsheets/d/1xfMcENDbVbWkwuexGOFjfz9MGp8aD5eFxslVIaeDDdg/pubhtml?gid=462942313&single=true&widget=true&headers=false",
  TF2: "https://docs.google.com/spreadsheets/d/1xfMcENDbVbWkwuexGOFjfz9MGp8aD5eFxslVIaeDDdg/pubhtml?gid=653219596&single=true&widget=true&headers=false",
  TF3: "https://docs.google.com/spreadsheets/d/1xfMcENDbVbWkwuexGOFjfz9MGp8aD5eFxslVIaeDDdg/pubhtml?gid=1655685068&single=true&widget=true&headers=false",
  TF4: "https://docs.google.com/spreadsheets/d/1xfMcENDbVbWkwuexGOFjfz9MGp8aD5eFxslVIaeDDdg/pubhtml?gid=70233464&single=true&widget=true&headers=false",
  ADMIN: "https://docs.google.com/spreadsheets/d/1xfMcENDbVbWkwuexGOFjfz9MGp8aD5eFxslVIaeDDdg/pubhtml?gid=477824279&single=true&widget=true&headers=false"
};

document.getElementById("sheetSelector").addEventListener("change", function() {
  const selected = this.value;
  const frame = document.getElementById("sheetFrame");
  const container = document.getElementById("sheetContainer");

  if (!selected) {
    container.classList.add("hidden");
    frame.src = "";
    return;
  }

  frame.src = sheetLinks[selected];
  container.classList.remove("hidden");
});

// ‚¨ÜÔ∏è UPLOAD
document.getElementById("uploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const file = document.getElementById("fileInput").files[0];
  const title = document.getElementById("title").value;

  const formData = new FormData();
  formData.append("file", file);
  formData.append("title", title);

  document.getElementById("status").innerText = "Uploading...";

  const res = await fetch("/.netlify/functions/uploadResource", {
    method: "POST",
    body: formData
  });

  const data = await res.json();

  if (data.success) {
    document.getElementById("status").innerText = "Upload successful.";
    document.getElementById("uploadForm").reset();
    loadAdminResources();
  } else {
    document.getElementById("status").innerText = "Upload failed.";
  }
});

// üìÇ LOAD FILES
async function loadAdminResources() {

  const res = await fetch("/.netlify/functions/getResources", {
    cache: "no-store"
  });

  const files = await res.json();

  const container = document.getElementById("adminResourceList");
  container.innerHTML = "";

  if (!files.length) {
    container.innerText = "No resources uploaded.";
    return;
  }

  files.forEach(file => {

    const row = document.createElement("div");
    row.className = "resource-row";

    const name = document.createElement("span");
    name.innerText = file.name;

    const delBtn = document.createElement("button");
    delBtn.className = "btn btn-danger text-sm";
    delBtn.innerText = "Delete";

    delBtn.onclick = async () => {

      const confirmDelete = confirm(`Delete "${file.name}"?`);
      if (!confirmDelete) return;

      delBtn.innerText = "Deleting...";
      delBtn.classList.add("btn-disabled");
      delBtn.disabled = true;

      const res = await fetch(
        `/.netlify/functions/uploadResource?name=${encodeURIComponent(file.file)}`,
        { method: "DELETE" }
      );

      const result = await res.json();

      if (result.success) {
        row.classList.add("fade-out");
        setTimeout(() => row.remove(), 300);
      } else {
        alert("Delete failed.");
        delBtn.innerText = "Delete";
        delBtn.classList.remove("btn-disabled");
        delBtn.disabled = false;
      }
    };

    row.appendChild(name);
    row.appendChild(delBtn);
    container.appendChild(row);
  });
}

</script>

</body>
</html>
