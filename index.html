<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POV SAR Forum 2026</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="SAR.png">
<meta name="theme-color" content="#0f172a">

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: system-ui, sans-serif; }

.card {
  background:#1e293b;
  border-radius:20px;
  padding:18px;
  box-shadow:0 0 30px rgba(0,0,0,.4);
}

.section-title { font-size:14px; font-weight:700; }
.source { color:#64748b; font-size:11px; margin-top:3px; }
.primary-value { font-size:22px; font-weight:900; margin-top:6px; }
.secondary-value { font-size:15px; color:#94a3b8; }

.tide-list { font-size:16px; font-weight:700; line-height:1.6; }

.subtitle { font-size:12px; color:#94a3b8; }
</style>
</head>

<body class="bg-slate-900 text-white">

<header class="bg-slate-800 py-4 text-center shadow-xl">

<img src="SAR.png" class="mx-auto h-14 mb-2">

<h1 class="text-lg font-black leading-tight">
Todd Dooley SAR Forum 2026
</h1>

<div class="subtitle mt-1">
HRBT Marine Operations Dashboard
</div>

<div class="flex flex-wrap justify-center gap-2 mt-4">

<a href="/gar.html"
class="px-4 py-2 rounded-lg font-bold bg-blue-600 hover:bg-blue-700 text-sm">
GAR
</a>

<a href="/sar-resources.html"
class="px-4 py-2 rounded-lg font-bold bg-emerald-600 hover:bg-emerald-700 text-sm">
RESOURCES
</a>

<a href="/admin.html"
class="px-4 py-2 rounded-lg font-bold bg-red-700 hover:bg-red-800 text-sm">
ADMIN
</a>

<a href="/povsargarapp-qr.png" target="_blank"
class="px-4 py-2 rounded-lg font-bold bg-purple-600 hover:bg-purple-700 text-sm">
INSTALL
</a>

<button onclick="loadMarineData()"
class="px-4 py-2 rounded-lg font-bold bg-orange-500 hover:bg-orange-600 text-sm">
REFRESH
</button>

</div>

<div class="mt-3 text-xs text-slate-400 animate-bounce">
↓ Marine Conditions Below ↓
</div>

</header>

<section class="max-w-6xl mx-auto p-4 space-y-6">

<div class="text-center text-xs text-slate-400">
Last Updated (Eastern): <span id="lastUpdated">--</span>
</div>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4">

<div class="card text-center">
<div class="section-title">WIND</div>
<div id="windText" class="primary-value">--</div>
<div id="windCardinal" class="secondary-value"></div>
</div>

<div class="card text-center">
<div class="section-title">WAVE HEIGHT</div>
<div id="waveHeight" class="primary-value">--</div>
</div>

<div class="card text-center">
<div class="section-title">WATER TEMP</div>
<div id="waterTemp" class="primary-value">--</div>
</div>

<div class="card text-center">
<div class="section-title">AIR TEMP</div>
<div id="airTemp" class="primary-value">--</div>
</div>

</div>

<div class="card text-center">

<div class="section-title">TIDES — Sewells Point</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">

<div>
<div class="font-semibold mb-1">Last 2</div>
<div id="lastTides" class="tide-list"></div>
</div>

<div>
<div class="font-semibold mb-1">Next 2</div>
<div id="nextTides" class="tide-list"></div>
</div>

</div>

</div>

</section>

<script>

function degToCardinal(deg) {
  if (!deg && deg !== 0) return "--";
  const dirs = ["N","NNE","NE","ENE","E","ESE","SE","SSE",
                "S","SSW","SW","WSW","W","WNW","NW","NNW"];
  return dirs[Math.round(deg / 22.5) % 16];
}

function parseEastern(str) {
  const [date, time] = str.split(" ");
  return new Date(date + "T" + time);
}

function formatTide(dateObj, type) {
  const label = type === "H" ? "High" : "Low";
  const time = dateObj.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit"});
  return `${label} — ${time}`;
}

async function loadMarineData() {

  const res = await fetch("/.netlify/functions/marine");
  const data = await res.json();

  document.getElementById("lastUpdated").innerText = data.serverTimeEST;

  const serverNow = new Date(data.serverTimeEST);

  const tides = data.tideData.predictions.map(t => ({
    ...t,
    parsed: parseEastern(t.t)
  }));

  tides.sort((a,b) => a.parsed - b.parsed);

  const past = tides.filter(t => t.parsed <= serverNow).slice(-2);
  const future = tides.filter(t => t.parsed > serverNow).slice(0,2);

  document.getElementById("lastTides").innerHTML =
    past.map(t => formatTide(t.parsed, t.type)).join("<br>");

  document.getElementById("nextTides").innerHTML =
    future.map(t => formatTide(t.parsed, t.type)).join("<br>");

  const windDeg = data.buoyData.windDirDeg;

  document.getElementById("windText").innerText =
    data.buoyData.windSpeedKnots + " kts";

  document.getElementById("windCardinal").innerText =
    degToCardinal(windDeg) + " (" + windDeg + "°)";

  document.getElementById("waveHeight").innerText =
    data.buoyData.waveHeightFt + " ft";

  document.getElementById("waterTemp").innerText =
    data.buoyData.waterTempF + " °F";

  document.getElementById("airTemp").innerText =
    data.buoyData.airTempF + " °F";
}

loadMarineData();

</script>

</body>
</html>
