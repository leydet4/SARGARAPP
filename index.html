<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Port of Virginia SAR Forum 2026 - Operations Dashboard</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0f172a" />
<link rel="icon" href="povsargarapp-qr.png">

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: system-ui, sans-serif; }

.card {
background:#1e293b;
border-radius:14px;
padding:24px;
}

.section-title {
font-size:18px;
font-weight:700;
margin-bottom:4px;
}

.source {
color:#64748b;
font-size:12px;
}

.primary-value {
font-size:28px;
font-weight:800;
margin-top:12px;
}

.secondary-value {
font-size:16px;
font-weight:600;
}

.compass {
width:160px;
height:160px;
border:3px solid #475569;
border-radius:50%;
position:relative;
margin:20px auto;
}

.arrow {
width:6px;
height:70px;
background:#f97316;
position:absolute;
top:10px;
left:50%;
transform-origin:bottom center;
border-radius:3px;
}

.center-dot {
width:10px;
height:10px;
background:white;
border-radius:50%;
position:absolute;
top:50%;
left:50%;
transform:translate(-50%, -50%);
}

.direction-label {
position:absolute;
font-size:14px;
font-weight:600;
color:#cbd5e1;
}

.n { top:6px; left:50%; transform:translateX(-50%); }
.s { bottom:6px; left:50%; transform:translateX(-50%); }
.e { right:6px; top:50%; transform:translateY(-50%); }
.w { left:6px; top:50%; transform:translateY(-50%); }

.tide-big {
font-size:26px;
font-weight:800;
margin-top:12px;
}
</style>
</head>

<body class="bg-slate-900 text-white">

<header class="bg-slate-800 p-4">
<h1 class="text-xl font-bold">
Port of Virginia Todd Dooley Search and Rescue Forum 2026
</h1>
</header>

<section class="p-6 space-y-8">

<div id="statusMessage" class="text-green-400 font-semibold text-lg">
Marine Data Connected
</div>

<div class="grid md:grid-cols-3 gap-8">

<!-- WIND -->
<div class="card text-center">

<div class="section-title">Wind</div>
<div id="windSource" class="source"></div>

<div class="compass">

<div class="direction-label n">N</div>
<div class="direction-label s">S</div>
<div class="direction-label e">E</div>
<div class="direction-label w">W</div>

<div id="windArrow" class="arrow"></div>
<div class="center-dot"></div>

</div>

<div id="windText" class="primary-value">--</div>
<div id="windCardinal" class="secondary-value text-slate-400"></div>

</div>

<!-- WAVES -->
<div class="card text-center">
<div class="section-title">Wave Height</div>
<div class="source">NOAA NDBC Buoy 44099</div>
<div id="waveHeight" class="primary-value">--</div>
</div>

<!-- WATER TEMP -->
<div class="card text-center">
<div class="section-title">Water Temperature</div>
<div class="source">NOAA NDBC Buoy 44099</div>
<div id="waterTemp" class="primary-value">--</div>
</div>

</div>

<!-- TIDES -->
<div class="card">

<div class="section-title">Tide Information</div>
<div class="source">NOAA CO-OPS Station 8638610 (Sewells Point)</div>

<div id="tideTrend" class="tide-big"></div>

<div class="grid md:grid-cols-2 gap-10 mt-6">

<div>
<div class="text-lg font-bold mb-2">Last 2 Tides</div>
<div id="lastTides" class="text-lg"></div>
</div>

<div>
<div class="text-lg font-bold mb-2">Next 2 Tides</div>
<div id="nextTides" class="text-lg"></div>
</div>

</div>

</div>

</section>

<script>

function degreesToCardinal(deg) {
if (deg === "N/A") return "";
const directions = ["N","NE","E","SE","S","SW","W","NW"];
return directions[Math.round(deg / 45) % 8];
}

async function loadMarineData() {

try {

const response = await fetch("/.netlify/functions/marine");
if (!response.ok) throw new Error("Function returned " + response.status);

const data = await response.json();

// WIND
if (data.buoyData) {

const deg = parseInt(data.buoyData.windDirDeg);

document.getElementById("windText").innerText =
data.buoyData.windSpeedKnots + " kts";

document.getElementById("windCardinal").innerText =
degreesToCardinal(deg) + " (" + deg + "°)";

document.getElementById("windArrow").style.transform =
`translateX(-50%) rotate(${deg}deg)`;

document.getElementById("windSource").innerText =
"Source: " + data.buoyData.windSource;

document.getElementById("waveHeight").innerText =
data.buoyData.waveHeightFt + " ft @ " +
data.buoyData.dominantPeriodSec + "s";

document.getElementById("waterTemp").innerText =
data.buoyData.waterTempF + " °F";
}

// TIDES
if (data.tideData?.predictions?.length > 0) {

const tides = data.tideData.predictions;
const now = new Date();

const lastTwo = tides.filter(t => new Date(t.t) < now).slice(-2);
const nextTwo = tides.filter(t => new Date(t.t) > now).slice(0,2);

document.getElementById("lastTides").innerHTML =
lastTwo.map(t => `<div>${t.type === "H" ? "High" : "Low"} - ${t.t}</div>`).join("");

document.getElementById("nextTides").innerHTML =
nextTwo.map(t => `<div>${t.type === "H" ? "High" : "Low"} - ${t.t}</div>`).join("");

if (nextTwo.length > 0) {
document.getElementById("tideTrend").innerText =
nextTwo[0].type === "H" ? "Rising ↑" : "Falling ↓";
}

}

} catch (error) {
document.getElementById("statusMessage").innerText = "Marine Data Failed";
document.getElementById("statusMessage").classList.replace("text-green-400","text-red-500");
console.error(error);
}

}

loadMarineData();
setInterval(loadMarineData, 300000);

</script>

</body>
</html>
