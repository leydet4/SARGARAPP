<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Port of Virginia Todd Dooley SAR Forum 2026</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0f172a" />
<link rel="icon" href="povsargarapp-qr.png">

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: system-ui, sans-serif; }
.card { background:#1e293b; border-radius:12px; padding:20px; }
.label { color:#94a3b8; font-size:13px; }
.value { font-size:18px; font-weight:600; }
.good { color:#22c55e; }
.caution { color:#f59e0b; }
.danger { color:#ef4444; }
</style>
</head>

<body class="bg-slate-900 text-white">

<header class="bg-slate-800 p-4 flex justify-between items-center">
<h1 class="text-lg md:text-xl font-bold">Port of Virginia SAR Forum 2026</h1>
<nav class="space-x-4 text-sm md:text-base">
<a href="index.html" class="text-orange-400">Dashboard</a>
<a href="gar.html">GAR</a>
</nav>
</header>

<section class="p-6">

<h2 class="text-2xl font-semibold mb-4">HRBT Marine Operations Dashboard</h2>

<div id="riskLevel" class="mb-6 text-lg font-bold"></div>

<div class="grid md:grid-cols-3 gap-6">

<div class="card">
<div class="label">Tide Trend</div>
<div id="tideTrend" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Current Water Level</div>
<div id="waterLevel" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Last 2 / Next 2 Tides</div>
<div id="tideList" class="value text-sm">Loading...</div>
</div>

<div class="card">
<div class="label">Wave Height / Period</div>
<div id="waveHeight" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Wind</div>
<div id="wind" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Air / Water Temp</div>
<div id="temps" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Pressure</div>
<div id="pressure" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Sunrise / Sunset</div>
<div id="sun" class="value">Loading...</div>
</div>

</div>

<div class="mt-10 text-center">
<img src="povsargarapp-qr.png" alt="QR Code" class="mx-auto w-40">
<p class="mt-3 text-sm text-slate-400">
Scan to open and install on mobile
</p>
</div>

</section>

<footer class="text-center p-4 text-slate-500 text-sm">
NOAA CO-OPS 8638610 | NDBC Buoy 44099 | Updates every 5 minutes
</footer>

<script>
async function fetchMarineData() {

try {

// ===== TIDE PREDICTIONS =====
const tideRes = await fetch("https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?product=predictions&application=web&begin_date=today&range=36&datum=MLLW&station=8638610&time_zone=lst_ldt&units=english&interval=hilo&format=json");
const tideData = await tideRes.json();

// ===== WATER LEVEL =====
const levelRes = await fetch("https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?product=water_level&application=web&date=latest&station=8638610&time_zone=lst_ldt&units=english&format=json");
const levelData = await levelRes.json();

// ===== BUOY DATA =====
const buoyRes = await fetch("https://www.ndbc.noaa.gov/data/realtime2/44099.json");
const buoyData = await buoyRes.json();

if (tideData.predictions) {
let now = new Date();
let tides = tideData.predictions;

let lastTwo = tides.filter(t => new Date(t.t) < now).slice(-2);
let nextTwo = tides.filter(t => new Date(t.t) > now).slice(0,2);

let trend = nextTwo[0].type === "H" ? "Rising ↑ toward High" : "Falling ↓ toward Low";
document.getElementById("tideTrend").innerText = trend;

let tideHTML = "";
lastTwo.forEach(t => tideHTML += `${t.type} ${t.t}<br>`);
nextTwo.forEach(t => tideHTML += `${t.type} ${t.t}<br>`);

document.getElementById("tideList").innerHTML = tideHTML;
}

if (levelData.data) {
document.getElementById("waterLevel").innerText =
`${levelData.data[0].v} ft`;
}

if (buoyData.data) {
let b = buoyData.data[0];

document.getElementById("waveHeight").innerText =
`${b.wave_height} ft @ ${b.dominant_wave_period}s`;

document.getElementById("wind").innerText =
`${b.wind_speed} kts (gust ${b.wind_gust}) ${b.wind_direction}°`;

document.getElementById("temps").innerText =
`Air ${b.air_temperature}°F | Water ${b.water_temperature}°F`;

document.getElementById("pressure").innerText =
`${b.air_pressure} mb`;

// Risk Assessment
let risk = "GOOD";
let className = "good";

if (b.wave_height > 4 || b.wind_speed > 20) {
risk = "HIGH RISK";
className = "danger";
} else if (b.wave_height > 2 || b.wind_speed > 15) {
risk = "CAUTION";
className = "caution";
}

document.getElementById("riskLevel").innerHTML =
`Operational Status: <span class="${className}">${risk}</span>`;
}

} catch (error) {
console.log(error);
}

}

fetchMarineData();
setInterval(fetchMarineData, 300000);
</script>

<script>
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
