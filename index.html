<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Port of Virginia Todd Dooley SAR Forum 2026</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#0f172a" />
<link rel="icon" href="povsargarapp-qr.png">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { font-family: system-ui, sans-serif; }
.card { background:#1e293b; border-radius:12px; padding:20px; }
.label { color:#94a3b8; font-size:13px; }
.value { font-size:18px; font-weight:600; }
.good { color:#22c55e; }
.caution { color:#f59e0b; }
.danger { color:#ef4444; }
#map { height: 400px; border-radius:12px; }
.compass {
width:150px;
height:150px;
border:4px solid #64748b;
border-radius:50%;
position:relative;
margin:auto;
}
.arrow {
width:4px;
height:60px;
background:#f97316;
position:absolute;
top:15px;
left:50%;
transform-origin:bottom;
}
</style>
</head>

<body class="bg-slate-900 text-white">

<header class="bg-slate-800 p-4 flex justify-between">
<h1 class="text-lg md:text-xl font-bold">POV SAR Forum 2026 - Ops Dashboard</h1>
<nav class="space-x-4">
<a href="index.html" class="text-orange-400">Dashboard</a>
<a href="gar.html">GAR</a>
</nav>
</header>

<section class="p-6 space-y-8">

<h2 class="text-2xl font-semibold">HRBT Operations Center</h2>

<div id="riskLevel" class="text-lg font-bold"></div>

<div class="grid md:grid-cols-3 gap-6">

<div class="card text-center">
<div class="label">Wind Compass</div>
<div class="compass mt-4">
<div id="windArrow" class="arrow"></div>
</div>
<div id="windText" class="value mt-4"></div>
</div>

<div class="card">
<div class="label">Wave Height / Period</div>
<div id="waveHeight" class="value">Loading...</div>
</div>

<div class="card">
<div class="label">Air / Water Temp</div>
<div id="temps" class="value">Loading...</div>
</div>

</div>

<div class="card">
<div class="label mb-4">24 Hour Tide Chart (Sewells Point)</div>
<canvas id="tideChart"></canvas>
</div>

<div class="card">
<div class="label mb-4">HRBT Operational Map</div>
<div id="map"></div>
</div>

<div class="text-center">
<img src="povsargarapp-qr.png" class="mx-auto w-40">
<p class="text-sm text-slate-400 mt-2">Scan to Install</p>
</div>

</section>

<footer class="text-center p-4 text-slate-500 text-sm">
NOAA 8638610 | Buoy 44099 | Updates every 5 minutes
</footer>

<script>
let tideChart;

async function fetchData() {
try {

// ===== TIDE 6-min interval for graph =====
const tideRes = await fetch(
"https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?product=water_level&application=web&begin_date=today&range=24&station=8638610&time_zone=lst_ldt&units=english&interval=6&format=json"
);
const tideData = await tideRes.json();

if(tideData.data){
let labels = tideData.data.map(d => d.t.substring(11,16));
let values = tideData.data.map(d => d.v);

if(tideChart) tideChart.destroy();

tideChart = new Chart(document.getElementById("tideChart"), {
type: "line",
data: {
labels: labels,
datasets: [{
label: "Water Level (ft)",
data: values,
borderColor: "#f97316",
backgroundColor: "rgba(249,115,22,0.2)",
fill: true,
tension: 0.4
}]
},
options: {
plugins: { legend: { labels:{ color:"white"} } },
scales: {
x: { ticks:{ color:"white"} },
y: { ticks:{ color:"white"} }
}
}
});
}

// ===== BUOY =====
const buoyRes = await fetch("https://www.ndbc.noaa.gov/data/realtime2/44099.json");
const buoyData = await buoyRes.json();

if(buoyData.data){
let b = buoyData.data[0];

document.getElementById("waveHeight").innerText =
`${b.wave_height} ft @ ${b.dominant_wave_period}s`;

document.getElementById("temps").innerText =
`Air ${b.air_temperature}°F | Water ${b.water_temperature}°F`;

document.getElementById("windText").innerText =
`${b.wind_speed} kts ${b.wind_direction}°`;

document.getElementById("windArrow").style.transform =
`translateX(-50%) rotate(${b.wind_direction}deg)`;

// Risk Logic
let risk = "GOOD";
let className = "good";

if (b.wave_height > 4 || b.wind_speed > 20) {
risk = "HIGH RISK";
className = "danger";
} else if (b.wave_height > 2 || b.wind_speed > 15) {
risk = "CAUTION";
className = "caution";
}

document.getElementById("riskLevel").innerHTML =
`Operational Status: <span class="${className}">${risk}</span>`;
}

} catch(err) {
console.log(err);
}
}

fetchData();
setInterval(fetchData, 300000);

// ===== MAP =====
const map = L.map('map').setView([36.98, -76.31], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '© OpenStreetMap'
}).addTo(map);

L.marker([36.95, -76.33]).addTo(map)
.bindPopup("Sewells Point Tide Station 8638610");

L.marker([36.94, -75.72]).addTo(map)
.bindPopup("Buoy 44099 - Chesapeake Bay Entrance");

// Service Worker
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
